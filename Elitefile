required_version is 0.1

# you can use use add_source files "..."
# to add file to files variable line by line.
set files as "/Tp./src/application/window.cpp
              /Tp./src/resources/sprite_resource.cpp
              /Tp./src/resources/timer_resource.cpp
              /Tp./src/resources/cursor_resource.cpp
              /Tp./src/resources/font_resource.cpp
              /Tp./src/resources/clipboard_resource.cpp
              /Tp./src/resources/audio_resource.cpp
              /Tp./src/resources/music_resource.cpp
              /Tp./src/resources/fes_loader_resource.cpp
              /Tp./src/resources/circle_resource.cpp
              /Tp./src/resources/color_resource.cpp
              /Tp./src/resources/point_resource.cpp
              /Tp./src/resources/edge_resource.cpp
              /Tp./src/resources/polygon_resource.cpp
              /Tp./src/objects/base_object.cpp
              /Tp./src/objects/sprite_object.cpp
              /Tp./src/objects/label_object.cpp
              /Tp./src/objects/physics/area_object.cpp
              /Tp./src/objects/physics/rectangle_area_object.cpp
              /Tp./src/objects/physics/circle_area_object.cpp
              /Tp./src/objects/physics/polygon_area_object.cpp
              /Tp./src/objects/physics/body_object.cpp
              /Tp./src/objects/physics/circle_body_object.cpp
              /Tp./src/objects/physics/polygon_body_object.cpp
              /Tp./src/objects/physics/rectangle_body_object.cpp
              /Tp./src/objects/physics/world_object.cpp
              /Tp./src/objects/camera_object.cpp
              /Tp./src/objects/music_player_object.cpp
              /Tp./src/objects/audio_player_object.cpp
              /Tp./src/objects/animation/animation_frame_object.cpp
              /Tp./src/objects/animation/animation_player_object.cpp
              /Tp./src/objects/circle_object.cpp
              /Tp./src/objects/polygon_object.cpp
              /Tp./src/objects/rectangle_object.cpp
              /Tp./src/objects/gui/gui_base_object.cpp
              /Tp./src/objects/gui/gui_button_object.cpp
              /Tp./src/objects/editor/editor_project_color_object.cpp
              /Tp./src/objects/editor/editor_project_file_object.cpp
              /Tp./src/objects/editor/editor_project_object.cpp
              /Tp./src/fes/fes_ast.cpp
              /Tp./src/fes/fes_parser.cpp
              /Tp./src/fes/fes_tokenizer.cpp
              /Tp./src/fescript/fescript_array.cpp
              /Tp./src/fescript/fescript_class.cpp
              /Tp./src/fescript/fescript_dict.cpp
              /Tp./src/fescript/fescript_environment.cpp
              /Tp./src/fescript/fescript_expr.cpp
              /Tp./src/fescript/fescript_function.cpp
              /Tp./src/fescript/fescript_instance.cpp
              /Tp./src/fescript/fescript_interpreter.cpp
              /Tp./src/fescript/fescript_parser.cpp
              /Tp./src/fescript/fescript_resolver.cpp
              /Tp./src/fescript/fescript_scanner.cpp
              /Tp./src/fescript/fescript_stmt.cpp
              /Tp./src/fescript/fescript_token.cpp
              /Tp./src/fescript/modules/fescript_math.cpp
              /Tp./src/fescript/modules/fescript_os.cpp
              /Tp./src/fescript/modules/fescript_path.cpp
              /Tp./src/fescript/modules/fescript_io.cpp
              /Tp./src/fescript/modules/fescript_prng.cpp
              /Tp./src/fescript/modules/engine_io.cpp
              /Tp./src/fescript/modules/engine.cpp
              /Tp./src/fescript/modules/engine_window.cpp
              /Tp./src/fescript/wrappers/fescript_base_object.cpp
              /Tp./src/fescript/wrappers/fescript_sprite_object.cpp
              /Tp./src/fescript/wrappers/fescript_label_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_area_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_rectangle_area_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_circle_area_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_polygon_area_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_world_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_body_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_circle_body_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_polygon_body_object.cpp
              /Tp./src/fescript/wrappers/physics/fescript_rectangle_body_object.cpp
              /Tp./src/fescript/wrappers/fescript_camera_object.cpp
              /Tp./src/fescript/wrappers/animation/fescript_animation_player_object.cpp
              /Tp./src/fescript/wrappers/animation/fescript_animation_frame_object.cpp
              /Tp./src/fescript/wrappers/fescript_music_player_object.cpp
              /Tp./src/fescript/wrappers/fescript_audio_player_object.cpp
              /Tp./src/fescript/wrappers/fescript_circle_object.cpp
              /Tp./src/fescript/wrappers/fescript_polygon_object.cpp
              /Tp./src/fescript/wrappers/fescript_rectangle_object.cpp
              /Tp./src/input/keyboard_input.cpp
              /Tp./src/input/mouse_input.cpp
              /Tp./src/render_objects.cpp
              /Tp./libs/imgui/imgui.cpp
              /Tp./libs/imgui/misc/cpp/imgui_stdlib.cpp
              /Tp./libs/imgui/imgui_demo.cpp
              /Tp./libs/imgui/imgui_draw.cpp
              /Tp./libs/imgui/imgui_tables.cpp
              /Tp./libs/imgui/imgui_widgets.cpp
              /Tp./libs/imgui/backends/imgui_impl_sdlrenderer2.cpp
              /Tp./libs/imgui/backends/imgui_impl_sdl2.cpp
              /Tp./libs/imgui/backends/imgui_impl_opengl3.cpp
              /Tp./src/freshengine.cpp"

set object_files as "window.obj
                     sprite_resource.obj
                     timer_resource.obj
                     cursor_resource.obj
                     font_resource.obj
                     clipboard_resource.obj
                     audio_resource.obj
                     music_resource.obj
                     fes_loader_resource.obj
                     circle_resource.obj
                     color_resource.obj
                     point_resource.obj
                     edge_resource.obj
                     polygon_resource.obj
                     base_object.obj
                     sprite_object.obj
                     label_object.obj
                     area_object.obj
                     rectangle_area_object.obj
                     circle_area_object.obj
                     polygon_area_object.obj
                     body_object.obj
                     circle_body_object.obj
                     polygon_body_object.obj
                     rectangle_body_object.obj
                     world_object.obj
                     camera_object.obj
                     music_player_object.obj
                     audio_player_object.obj
                     animation_frame_object.obj
                     animation_player_object.obj
                     circle_object.obj
                     polygon_object.obj
                     rectangle_object.obj
                     gui_base_object.obj
                     gui_button_object.obj
                     editor_project_color_object.obj
                     editor_project_file_object.obj
                     editor_project_object.obj
                     fes_ast.obj
                     fes_parser.obj
                     fes_tokenizer.obj
                     fescript_array.obj
                     fescript_class.obj
                     fescript_dict.obj
                     fescript_environment.obj
                     fescript_expr.obj
                     fescript_function.obj
                     fescript_instance.obj
                     fescript_interpreter.obj
                     fescript_parser.obj
                     fescript_resolver.obj
                     fescript_scanner.obj
                     fescript_stmt.obj
                     fescript_token.obj
                     fescript_math.obj
                     fescript_os.obj
                     fescript_path.obj
                     fescript_io.obj
                     fescript_prng.obj
                     engine_io.obj
                     engine.obj
                     engine_window.obj
                     fescript_base_object.obj
                     fescript_sprite_object.obj
                     fescript_label_object.obj
                     fescript_area_object.obj
                     fescript_rectangle_area_object.obj
                     fescript_circle_area_object.obj
                     fescript_polygon_area_object.obj
                     fescript_world_object.obj
                     fescript_body_object.obj
                     fescript_circle_body_object.obj
                     fescript_polygon_body_object.obj
                     fescript_rectangle_body_object.obj
                     fescript_camera_object.obj
                     fescript_animation_player_object.obj
                     fescript_animation_frame_object.obj
                     fescript_music_player_object.obj
                     fescript_audio_player_object.obj
                     fescript_circle_object.obj
                     fescript_polygon_object.obj
                     fescript_rectangle_object.obj
                     keyboard_input.obj
                     mouse_input.obj
                     render_objects.obj
                     imgui.obj
                     imgui_stdlib.obj
                     imgui_demo.obj
                     imgui_draw.obj
                     imgui_tables.obj
                     imgui_widgets.obj
                     imgui_impl_sdlrenderer2.obj
                     imgui_impl_sdl2.obj
                     imgui_impl_opengl3.obj
                     freshengine.obj"


set static_dependencies as "./libs/SDL/lib/x64/SDL2.lib
                            ./libs/SDL_image/lib/x64/SDL2_image.lib
                            ./libs/SDL_ttf/lib/x64/SDL2_ttf.lib
                            ./libs/SDL_mixer/lib/x64/SDL2_mixer.lib
                            ./libs/box2d/Build/src/Release/box2d.lib"

set static_libs as "{static_dependencies}
                    kernel32.lib
                    user32.lib
                    gdi32.lib
                    shell32.lib
                    fresh_lib.lib"

set include_dirs as "/I./libs/SDL/include/
                    /I./libs/SDL_image/include/
                    /I./libs/SDL_mixer/include/
                    /I./libs/SDL_ttf/include/
                    /I./libs/imgui/
                    /I./libs/imgui/backends/
                    /I./libs/idk/idk/
                    /I./libs/box2d/include/
                    /I./libs/colorized/
                    /I./include/"

set compiler_params as "/O2 /MD /EHsc /Zi /DEBUG /fsanitize=address /std:c++20 /MP /DWIN64"
set just_compile_example as "false"

for signal "start" [
  for argument "only_example" [
    set just_compile_example as "true"
  ]

  println "Info: `only_example` parameter is set as {just_compile_example}."

  if eq "{just_compile_example}" "false" [
    use exec "cl.exe {compiler_params} /c {include_dirs} {files} /link {static_dependencies}"
    use exec "lib.exe {object_files} /out:fresh_lib.lib"
  ]

  if eq "{just_compile_example}" "true" [
    set is_fresh_static_lib_exists as "false"
    for exists "fresh_lib.lib" [
      set is_fresh_static_lib_exists as "true"
    ]
    println $is_fresh_static_lib_exists
    if eq "{is_fresh_static_lib_exists}" "false" [
      println "Error: There is no fresh static library named as `fresh_lib.lib`.
               \r       So, using `only_example` wouldn't work."
      use signal "exit"
    ]
  ]

  use exec "cl.exe {compiler_params} {include_dirs} /Tp./example/example_lib.cpp /Feeditor.exe {static_libs}"
  use exec "cmd.exe /c del {object_files} example_lib.obj"
]